**TCP和UDP的区别：**

1.TCP面向连接，UDP是无连接的

2.TCP通过滑动窗口、确认应答机制、分片等方式，提供可靠的服务；UDP是尽最大努力交付，不保证可靠传输。

3.TCP只支持点到点的通信，UDP支持一对多的多播通信

4.TCP首部开销比UDP大，TCP占用的系统资源多，发送消息的过程相对复杂，效率比UDP低

5.TCP面向字节流，可能发生粘包问题，UDP面向数据报，不存在粘包问题（UDP包头部有长度字段，但是TCP是字节流，没有长度概念）

6.TCP每次建立连接时；客户端套接字和服务端套接字需要长期建立连接不中断，一个端口只能每次连接到来自同一个服务器的数据。UDP每个客户端端口并不需要和服务器端口建立长期的连接，可以每次向一个服务器发起申请，然后下一次再向另外一个服务器端口申请接收数据。

**TCP粘包问题的产生和解决对策**

**问题描述：**

TCP传输协议是面向流的，就是没有界限的一串数据，TCP底层并不了解上册业务数据的具体含义，会根据TCP缓冲区的实际情况进行包的划分，一个完整的包会被拆分成多个包发送。UDP面向数据报，每个包都有UDP的消息头，消息头中有UDP数据报的长度,故不会发生粘包。TCP粘包是指发送方发送的若干个包到接收方接受时粘成一包，从接收缓冲区看，后一包数据的头紧接着前一个包数据的尾。

**产生原因：**

网络通信过程中，每次可以发送的数据包大小是受多种因素限制的。如MTU传输单元大小，MSS最大分段大小，滑动窗口等。传输的数据包超过了传输单元的大小，数据就会拆分成多个数据包发送出去。当发送的数据包很小时，如果每次发送一个包发送次数会很大，这种情况下TCP通过采用Nagle算法对此优化，**Nagle算法就是为了尽可能发送大块数据，避免网络中充斥着许多小数据块。**

MTU：链路层一次最大传输数据

MSS：TCP最大报文长度

MSS = MTU -IP首部 - TCP首部

如果  MSS + IP首部 + TCP首部  > MTU,进行拆包，分多个包发送。

Nagle算法：任意时刻，最多只能有一个未被确认的小段。 所谓“小段”，指的是小于MSS尺寸的数据块，所谓“未被确认”，是指一个数据块发送出去后，没有收到对方发送的ACK确认该数据已收到。

**解决策略**

发送方关闭Nagle算法，接收方接收到消息直接发送。

底层的TCP无法理解上层的业务数据，底层无法保证数据包不被拆分和重组，只能通过上层的应用层设计进行解决。

1.应用层保证发送包定长，如果不够用空位补空格。缺点是浪费带宽。

2.应用层在每条消息前后增加标志位或者在消息头部加包长度，每次读取时先读长度再读数据。

